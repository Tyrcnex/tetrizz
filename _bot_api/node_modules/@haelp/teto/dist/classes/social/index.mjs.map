{"version":3,"sources":["../../../src/classes/social/index.ts"],"sourcesContent":["import { Events, type Social as SocialTypes } from \"../../types\";\nimport { APITypes } from \"../../utils\";\nimport type { Client } from \"../client\";\nimport { Relationship } from \"./relationship\";\n\nimport _ from \"lodash\";\n\ninterface SocialInitData {\n  online: number;\n  notifications: SocialTypes.Notification[];\n  friends: ReturnType<typeof processRelationship>[];\n  other: ReturnType<typeof processRelationship>[];\n  blocked: SocialTypes.Blocked[];\n}\n\nconst processRelationship = (r: SocialTypes.Relationship, selfID: string) => ({\n  ...r,\n  user: {\n    id: r.from._id === selfID ? r.to._id : r.from._id,\n    username: r.from._id === selfID ? r.to.username : r.from.username,\n    avatar:\n      r.from._id === selfID ? r.to.avatar_revision : r.from.avatar_revision\n  }\n});\n\nexport class Social {\n  private client: Client;\n\n  /** The current number of people online */\n  public online: number;\n  /** List of the client's friends */\n  public friends: Relationship[];\n  /** List of \"pending\" relationships (shows in `other` tab on TETR.IO) */\n  public other: Relationship[];\n  /** people you block */\n  public blocked: SocialTypes.Blocked[];\n  /** Notifications */\n  public notifications: SocialTypes.Notification[];\n  /** Social config */\n  public config: SocialTypes.Config;\n\n  public static defaultConfig: SocialTypes.Config = {\n    suppressDMErrors: false,\n    autoLoadDMs: true\n  };\n\n  /** @hideconstructor */\n  private constructor(\n    client: Client,\n    config: Partial<SocialTypes.Config>,\n    init: SocialInitData\n  ) {\n    this.client = client;\n    this.config = _.merge(Social.defaultConfig, config);\n\n    this.init();\n    this.online = init.online;\n    this.friends = init.friends.map(\n      (r) =>\n        new Relationship(\n          {\n            id: r.user.id,\n            relationshipID: r._id,\n            username: r.user.username,\n            avatar: r.user.avatar\n          },\n          this,\n          this.client\n        )\n    );\n    this.other = init.other.map(\n      (r) =>\n        new Relationship(\n          {\n            id: r.user.id,\n            relationshipID: r._id,\n            username: r.user.username,\n            avatar: r.user.avatar\n          },\n          this,\n\n          this.client\n        )\n    );\n    this.blocked = init.blocked;\n    this.notifications = init.notifications;\n  }\n\n  static async create(\n    client: Client,\n    config: Partial<SocialTypes.Config>,\n    initData: Events.in.Client[\"client.ready\"][\"social\"]\n  ) {\n    const rel = initData.relationships.map((r) =>\n      processRelationship(r, client.user.id)\n    );\n    const data: SocialInitData = {\n      online: initData.total_online,\n      notifications: initData.notifications,\n      friends: rel.filter((r) => r.type === \"friend\"),\n      other: rel.filter((r) => r.type === \"pending\"),\n\n      blocked: rel\n        .filter((r) => r.type === \"block\")\n        .map((r) => ({\n          id: r.user.id,\n          username: r.user.username,\n          avatar: r.user.avatar\n        }))\n    };\n\n    return new Social(client, config, data);\n  }\n\n  private get api() {\n    return this.client.api;\n  }\n\n  private init() {\n    setTimeout(\n      () =>\n        this.notifications.forEach((n) => {\n          if (n.type === \"friend\") {\n            if (!n.seen) {\n              const rel = processRelationship(\n                n.data.relationship,\n                this.client.user.id\n              );\n              this.client.emit(\"client.friended\", {\n                id: rel.user.id,\n                name: rel.user.username,\n                avatar: rel.user.avatar\n              });\n            }\n          }\n        }),\n      0\n    );\n\n    this.client.on(\"social.online\", (count) => {\n      this.online = count;\n    });\n\n    this.client.on(\"social.notification\", async (n) => {\n      this.notifications.splice(0, 0, n);\n\n      if (n.type === \"friend\") {\n        const rel = processRelationship(\n          n.data.relationship,\n          this.client.user.id\n        );\n        this.client.emit(\"client.friended\", {\n          id: rel.user.id,\n          name: rel.user.username,\n          avatar: rel.user.avatar\n        });\n\n        const user = this.get({ id: rel.user.id });\n\n        if (!user) {\n          this.other.push(\n            new Relationship(\n              {\n                id: rel.user.id,\n                username: rel.user.username,\n                avatar: rel.user.avatar,\n                relationshipID: \"\"\n              },\n              this,\n              this.client\n            )\n          );\n        }\n      }\n    });\n\n    this.client.on(\"social.dm\", async (dm) => {\n      let user = this.get({ id: dm.data.user });\n      if (user) {\n        if (!user.dmsLoaded && this.config.autoLoadDMs) await user.loadDms();\n        else user.dms.push(dm);\n      } else {\n        const u = await this.who(dm.data.user);\n        this.other.push(\n          new Relationship(\n            {\n              id: u._id,\n              username: u.username,\n              avatar: u.avatar_revision,\n              relationshipID: \"\"\n            },\n            this,\n            this.client\n          )\n        );\n\n        user = this.get({ id: dm.data.user })!;\n        if (this.config.autoLoadDMs) await user.loadDms();\n      }\n\n      this.client.emit(\"client.dm\", {\n        user,\n        content: dm.data.content,\n        reply: (content: string) => this.dm(dm.data.user, content)\n      });\n    });\n  }\n\n  /**\n   * Marks all notifications as read\n   * @example\n   * client.social.markNotificationsAsRead();\n   */\n  markNotificationsAsRead() {\n    this.client.emit(\"social.notification.ack\");\n  }\n\n  /**\n   * Get a user + social data from the list of users and pending friends (OTHER tab in TETR.IO)\n   * @example\n   * const user = await client.social.get('halp')\n   * @example\n   * const user = await client.social.get('646f633d276f42a80ba44304');\n   * @example\n   * const user = await client.social.get({ username: 'halp' });\n   * @example\n   * const user = await client.social.get({ id: '646f633d276f42a80ba44304 });\n   * @example\n   * // You can then use the object to read user data and interact with the user\n   * await user.dm('wanna play?');\n   * await user.invite();\n   */\n  get(target: string): Relationship | null;\n  get(target: { id: string }): Relationship | null;\n  get(target: { username: string }): Relationship | null;\n  get(\n    target: string | { id: string } | { username: string }\n  ): Relationship | null {\n    if (typeof target === \"string\")\n      return (\n        this.friends.find((r) => r.id === target || r.username === target) ||\n        this.other.find((r) => r.id === target || r.username === target) ||\n        null\n      );\n    else if (\"id\" in target)\n      return (\n        this.friends.find((r) => r.id === target.id) ||\n        this.other.find((r) => r.id === target.id) ||\n        null\n      );\n    else\n      return (\n        this.friends.find((r) => r.username === target.username) ||\n        this.other.find((r) => r.username === target.username) ||\n        null\n      );\n  }\n\n  /**\n   * Get the user id given a username\n   */\n  async resolve(username: string) {\n    return await this.api.users.resolve(username);\n  }\n\n  /** Get a users' information based on their userid or username\n   * @example\n   * const user = await client.social.who(await client.social.resolve('halp'));\n   */\n  who(id: string): Promise<APITypes.Users.User>;\n  async who(id: string): Promise<APITypes.Users.User> {\n    return this.api.users.get({ id });\n  }\n\n  /**\n   * Send a message to a specified user (based on id)\n   * @example\n   * await client.social.dm(await client.social.resolve('halp'), 'what\\'s up?');\n   */\n  dm(userID: string, message: string) {\n    const res = this.client.wrap(\n      \"social.dm\",\n      {\n        recipient: userID,\n        msg: message\n      },\n      \"social.dm\",\n      [\"social.dm.fail\", \"client.error\"]\n    );\n\n    if (this.config.suppressDMErrors) res.catch(() => {});\n\n    return res;\n  }\n\n  /**\n   * Send a user a friend request\n   * @example\n   * await client.social.friend(await client.social.resolve('halp'));\n   * @returns false if the user is already friended, true otherwise\n   * @throws {Error} If an error occurs (such as the user has blocked the client, etc)\n   */\n  async friend(userID: string) {\n    if (this.friends.find((r) => r.id === userID)) return false;\n    await this.api.social.friend(userID);\n    const userData = await this.who(userID);\n    this.friends.push(\n      new Relationship(\n        {\n          id: userData._id,\n          relationshipID: \"\",\n          username: userData.username,\n          avatar: userData.avatar_revision\n        },\n        this,\n        this.client\n      )\n    );\n\n    return true;\n  }\n\n  /**\n   * Unfriend a user. Note: unfriending a user will unblock them if they are blocked.\n   * @example\n   * await client.social.unfriend(await client.social.resolve('halp'));\n   * @returns false if the user is not unfriended, true otherwise\n   */\n  async unfriend(userID: string) {\n    if (!this.friends.find((r) => r.id === userID)) return false;\n    await this.api.social.unfriend(userID);\n    this.friends = this.friends.filter((r) => r.id !== userID);\n\n    return true;\n  }\n\n  /**\n   * Block a user\n   * @example\n   * await client.social.block(await client.social.resolve('halp'));\n   * @returns false if the user is already blocked, true otherwise\n   */\n  async block(userID: string) {\n    if (this.blocked.find((r) => r.id === userID)) return false;\n    await this.api.social.block(userID);\n  }\n\n  /**\n   * Unblock a user. Note: unblocking a user will unfriend them if they are friended.\n   * @example\n   * await client.social.unblock(await client.social.resolve('halp'));\n   * @returns false if the user is not unblocked, true otherwise\n   */\n  async unblock(userID: string) {\n    await this.api.social.unblock(userID);\n  }\n\n  /**\n   * Invite a user to your room\n   * @example\n   * await client.social.invite(await client.social.resolve('halp'));\n   */\n  invite(userID: string) {\n    return new Promise<void>(async (resolve, reject) => {\n      let r = false;\n      this.client.emit(\"social.invite\", userID);\n      const l = (e: string) => {\n        if (r) return;\n        r = true;\n        reject(e);\n      };\n      this.client.once(\"client.error\", l);\n      await new Promise((r) => setTimeout(r, 100));\n      this.client.off(\"client.error\", l);\n      r = true;\n      resolve();\n    });\n  }\n\n  /**\n   * Set the client's status\n   * @example\n   * client.social.status('online', 'lobby:X-QP');\n   */\n  status(status: SocialTypes.Status, detail: SocialTypes.Detail | String = \"\") {\n    this.client.emit(\"social.presence\", { status, detail });\n  }\n}\n\nexport * from \"./relationship\";\n"],"names":["Relationship","_","processRelationship","r","selfID","user","id","from","_id","to","username","avatar","avatar_revision","Social","client","online","friends","other","blocked","notifications","config","defaultConfig","suppressDMErrors","autoLoadDMs","init","merge","map","relationshipID","create","initData","rel","relationships","data","total_online","filter","type","api","setTimeout","forEach","n","seen","relationship","emit","name","on","count","splice","get","push","dm","dmsLoaded","loadDms","dms","u","who","content","reply","markNotificationsAsRead","target","find","resolve","users","userID","message","res","wrap","recipient","msg","catch","friend","social","userData","unfriend","block","unblock","invite","Promise","reject","l","e","once","off","status","detail"],"mappings":"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"}