{"version":3,"sources":["../../../src/engine/queue/index.ts"],"sourcesContent":["import { type BagType, type RngInnerFunction, rngMap } from \"./rng\";\nimport { Mino } from \"./types\";\n\nexport interface QueueInitializeParams {\n  seed: number;\n  type: BagType;\n  minLength: number;\n}\n\nexport class Queue {\n  seed: number;\n  type: BagType;\n  genFunction!: RngInnerFunction;\n  value: Mino[];\n  _minLength!: number;\n  index: number;\n  repopulateListener: ((pieces: Mino[]) => void) | null = null;\n  constructor(options: QueueInitializeParams) {\n    this.seed = options.seed;\n    this.type = options.type;\n    this.reset();\n    this.value = [];\n    this.minLength = options.minLength;\n\n    this.index = 0;\n  }\n\n  reset(index = 0) {\n    this.genFunction = rngMap[this.type](this.seed);\n    this.value = [];\n    this.index = 0;\n    this.repopulate();\n    for (let i = 0; i < index; i++) {\n      this.shift();\n      this.repopulate();\n    }\n  }\n\n  onRepopulate(listener: NonNullable<typeof this.repopulateListener>) {\n    this.repopulateListener = listener;\n  }\n\n  get minLength() {\n    return this._minLength;\n  }\n  set minLength(val: number) {\n    this._minLength = val;\n    this.repopulate();\n  }\n\n  get next() {\n    return this.value[0];\n  }\n\n  at(index: number) {\n    return this.value.at(index);\n  }\n\n  shift() {\n    const val = this.value.shift();\n    this.index++;\n    this.repopulate();\n    return val;\n  }\n\n  private repopulate() {\n    const added: Mino[] = [];\n    while (this.value.length < this.minLength) {\n      const newValues = this.genFunction();\n      this.value.push(...newValues);\n      added.push(...newValues);\n    }\n\n    if (this.repopulateListener && added.length) {\n      this.repopulateListener(added);\n    }\n  }\n}\nexport * from \"./rng\";\nexport * from \"./types\";\n"],"names":["rngMap","Queue","seed","type","genFunction","value","_minLength","index","repopulateListener","options","reset","minLength","repopulate","i","shift","onRepopulate","listener","val","next","at","added","length","newValues","push"],"mappings":"AAAA,SAA8CA,MAAM,QAAQ,QAAQ;AASpE,OAAO,MAAMC;IACXC,KAAa;IACbC,KAAc;IACdC,YAA+B;IAC/BC,MAAc;IACdC,WAAoB;IACpBC,MAAc;IACdC,qBAAwD,KAAK;IAC7D,YAAYC,OAA8B,CAAE;QAC1C,IAAI,CAACP,IAAI,GAAGO,QAAQP,IAAI;QACxB,IAAI,CAACC,IAAI,GAAGM,QAAQN,IAAI;QACxB,IAAI,CAACO,KAAK;QACV,IAAI,CAACL,KAAK,GAAG,EAAE;QACf,IAAI,CAACM,SAAS,GAAGF,QAAQE,SAAS;QAElC,IAAI,CAACJ,KAAK,GAAG;IACf;IAEAG,MAAMH,QAAQ,CAAC,EAAE;QACf,IAAI,CAACH,WAAW,GAAGJ,MAAM,CAAC,IAAI,CAACG,IAAI,CAAC,CAAC,IAAI,CAACD,IAAI;QAC9C,IAAI,CAACG,KAAK,GAAG,EAAE;QACf,IAAI,CAACE,KAAK,GAAG;QACb,IAAI,CAACK,UAAU;QACf,IAAK,IAAIC,IAAI,GAAGA,IAAIN,OAAOM,IAAK;YAC9B,IAAI,CAACC,KAAK;YACV,IAAI,CAACF,UAAU;QACjB;IACF;IAEAG,aAAaC,QAAqD,EAAE;QAClE,IAAI,CAACR,kBAAkB,GAAGQ;IAC5B;IAEA,IAAIL,YAAY;QACd,OAAO,IAAI,CAACL,UAAU;IACxB;IACA,IAAIK,UAAUM,GAAW,EAAE;QACzB,IAAI,CAACX,UAAU,GAAGW;QAClB,IAAI,CAACL,UAAU;IACjB;IAEA,IAAIM,OAAO;QACT,OAAO,IAAI,CAACb,KAAK,CAAC,EAAE;IACtB;IAEAc,GAAGZ,KAAa,EAAE;QAChB,OAAO,IAAI,CAACF,KAAK,CAACc,EAAE,CAACZ;IACvB;IAEAO,QAAQ;QACN,MAAMG,MAAM,IAAI,CAACZ,KAAK,CAACS,KAAK;QAC5B,IAAI,CAACP,KAAK;QACV,IAAI,CAACK,UAAU;QACf,OAAOK;IACT;IAEQL,aAAa;QACnB,MAAMQ,QAAgB,EAAE;QACxB,MAAO,IAAI,CAACf,KAAK,CAACgB,MAAM,GAAG,IAAI,CAACV,SAAS,CAAE;YACzC,MAAMW,YAAY,IAAI,CAAClB,WAAW;YAClC,IAAI,CAACC,KAAK,CAACkB,IAAI,IAAID;YACnBF,MAAMG,IAAI,IAAID;QAChB;QAEA,IAAI,IAAI,CAACd,kBAAkB,IAAIY,MAAMC,MAAM,EAAE;YAC3C,IAAI,CAACb,kBAAkB,CAACY;QAC1B;IACF;AACF;AACA,cAAc,QAAQ;AACtB,cAAc,UAAU"}